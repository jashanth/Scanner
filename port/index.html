<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Delta - Port Scanner</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

    body {
      font-family: 'Inter', sans-serif;
      background-color: #0f172a;
      color: #e2e8f0;
      transition: background-color 0.3s, color 0.3s;
    }

    .main-container {
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: 256px;
      background-color: #1e293b;
      padding: 1.5rem;
      border-right: 2px solid #334155;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      flex-shrink: 0;
      transition: background-color 0.3s, border-right 0.3s;
    }

    .sidebar-button {
      width: 100%;
      text-align: left;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      color: #94a3b8;
      font-weight: 600;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      text-decoration: none;
    }

    .sidebar-button:hover,
    .sidebar-button.active {
      color: #e2e8f0;
      background-color: #0ea5e9;
    }

    .sidebar-button svg {
      width: 1.25rem;
      height: 1.25rem;
      flex-shrink: 0;
    }

    .content-area {
      flex-grow: 1;
      padding: 2rem;
      display: flex;
      flex-direction: column;
    }

    .card {
      background-color: #1e293b;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      transition: transform 0.2s ease-in-out, background-color 0.3s, color 0.3s;
    }

    .form-input {
      width: 100%;
      padding: 0.75rem 1rem;
      border-radius: 0.5rem;
      background-color: #334155;
      border: 1px solid #475569;
      color: #e2e8f0;
      font-size: 0.875rem;
      transition: all 0.2s;
    }

    .form-input:focus {
      outline: none;
      border-color: #0ea5e9;
      background-color: #1e293b;
    }

    .btn {
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      transition: all 0.2s;
      cursor: pointer;
    }

    .btn-primary {
      background-color: #0ea5e9;
      color: white;
    }

    .btn-primary:hover {
      background-color: #0284c7;
    }

    .btn-primary:disabled {
      background-color: #475569;
      cursor: not-allowed;
    }

    .btn-secondary {
      background-color: #475569;
      color: white;
    }

    .btn-secondary:hover {
      background-color: #334155;
    }

    .results-area {
      background-color: #152238;
      border-radius: 1rem;
      min-height: 400px;
      max-height: 600px;
      overflow-y: auto;
      padding: 1.5rem;
    }

    .results-area::-webkit-scrollbar {
      width: 8px;
    }

    .results-area::-webkit-scrollbar-track {
      background: #1e293b;
    }

    .results-area::-webkit-scrollbar-thumb {
      background-color: #475569;
      border-radius: 4px;
    }

    .results-area::-webkit-scrollbar-thumb:hover {
      background-color: #64748b;
    }

    .header-section {
      margin-bottom: 2rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid #334155;
    }

    .stat-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-size: 0.875rem;
      font-weight: 600;
    }

    .stat-badge.success {
      background-color: rgba(16, 185, 129, 0.1);
      color: #10b981;
    }

    .stat-badge.info {
      background-color: rgba(14, 165, 233, 0.1);
      color: #0ea5e9;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    thead th {
      text-align: left;
      padding: 0.75rem;
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      color: #94a3b8;
      border-bottom: 1px solid #334155;
    }

    tbody tr {
      border-bottom: 1px solid rgba(51, 65, 85, 0.5);
      transition: background-color 0.2s;
    }

    tbody tr:hover {
      background-color: rgba(51, 65, 85, 0.3);
    }

    tbody td {
      padding: 0.75rem;
      font-size: 0.875rem;
    }

    .status-open {
      color: #10b981;
      font-weight: 600;
    }

    .status-closed {
      color: #ef4444;
      font-weight: 600;
    }

    .grid-2-cols {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
    }

    @media (max-width: 1024px) {
      .grid-2-cols {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>

  <div class="main-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="flex items-center gap-2">
        <img src="https://t3.ftcdn.net/jpg/01/68/62/98/360_F_168629858_n3Lw3i71XzIlwCtVNmeOiJhvI3Wa44Ni.jpg"
          alt="Delta Logo" class="w-8 h-8">
        <h1 class="text-2xl font-bold">Delta</h1>
      </div>
      <nav class="flex flex-col gap-1">
        <!-- MAIN -->
        <div>
          <h2 class="px-4 mb-2 text-xs font-bold uppercase text-gray-500">Main</h2>
          <a href="/dashboard" class="sidebar-button">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
              stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" />
            </svg>
            <span>Dashboard</span>
          </a>
        </div>

        <!-- TOOLS -->
        <div class="mt-4">
          <h2 class="px-4 mb-2 text-xs font-bold uppercase text-gray-500">Tools</h2>
          <a href="#" class="sidebar-button active">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
              stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M8.288 15.038a5.25 5.25 0 017.424 0M5.136 12.006a8.25 8.25 0 0113.728 0M2.002 8.995a11.25 11.25 0 0119.996 0" />
            </svg>
            <span>Port Scan</span>
          </a>
        </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="content-area">
      <!-- Header -->
      <div class="header-section">
        <div class="flex items-center justify-between flex-wrap gap-4">
          <div>
            <h1 class="text-3xl font-bold mb-1">Port Scanner</h1>
            <p class="text-slate-400 text-sm">Scan target hosts for open TCP ports and service detection.</p>
          </div>
          <a href="/dashboard" class="btn btn-secondary">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
            </svg>
            Back to Dashboard
          </a>
        </div>
      </div>

      <!-- Main Grid -->
      <div class="grid-2-cols">
        <!-- Left: Scan Configuration -->
        <div>
          <h2 class="text-xl font-semibold mb-3">Scan Configuration</h2>
          <div class="card">
            <div class="mb-4">
              <label for="target" class="block text-sm font-semibold mb-2 text-slate-300">Target Host</label>
              <input type="text" id="target" placeholder="scanme.nmap.org or 192.168.1.1" class="form-input">
              <p class="text-xs text-slate-500 mt-1">Enter hostname or IP address</p>
            </div>
            
            <div class="mb-4">
              <label for="ports" class="block text-sm font-semibold mb-2 text-slate-300">Ports</label>
              <input type="text" id="ports" placeholder="22,80,443 or 20-25 or leave blank for common ports" class="form-input">
              <p class="text-xs text-slate-500 mt-1">Comma-separated or range format (e.g., 1-1000)</p>
            </div>

            <div class="mb-6">
              <label for="timeout" class="block text-sm font-semibold mb-2 text-slate-300">Timeout (seconds)</label>
              <input type="number" id="timeout" value="1" min="1" max="10" class="form-input">
              <p class="text-xs text-slate-500 mt-1">Connection timeout for each port</p>
            </div>

            <button id="scanBtn" class="btn btn-primary w-full">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
              </svg>
              Start Scan
            </button>
          </div>
        </div>

        <!-- Right: Results -->
        <div>
          <h2 class="text-xl font-semibold mb-3">Scan Results</h2>
          <div id="results" class="results-area">
            <div class="flex flex-col items-center justify-center" style="min-height: 300px;">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-16 h-16 text-slate-600 mb-4">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8.288 15.038a5.25 5.25 0 017.424 0M5.136 12.006a8.25 8.25 0 0113.728 0M2.002 8.995a11.25 11.25 0 0119.996 0M10.5 19.5h3" />
              </svg>
              <p class="text-slate-500 text-center">Enter a target and click "Start Scan" to begin.</p>
              <p class="text-slate-600 text-xs mt-2">Results will appear here in real-time.</p>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

<script>
const scanBtn = document.getElementById("scanBtn");
const resultsDiv = document.getElementById("results");

function escapeHtml(unsafe) {
  if (!unsafe) return "";
  return String(unsafe)
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

scanBtn.addEventListener("click", async () => {
  const target = document.getElementById("target").value.trim();
  const ports = document.getElementById("ports").value.trim();
  const timeout = document.getElementById("timeout").value.trim();

  if (!target) {
    resultsDiv.innerHTML = `
      <div class="p-4 bg-red-900/30 border border-red-700/50 text-red-300 rounded-lg flex items-start gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 flex-shrink-0 mt-0.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
        </svg>
        <div>
          <div class="font-semibold">Missing Target</div>
          <div class="text-sm">Please enter a valid hostname or IP address.</div>
        </div>
      </div>
    `;
    return;
  }

  resultsDiv.innerHTML = `
    <div class="flex items-center gap-3 p-4">
      <div class="animate-spin">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-sky-400">
          <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
        </svg>
      </div>
      <div>
        <div class="font-semibold text-slate-200">Scanning ${escapeHtml(target)}...</div>
        <div class="text-sm text-slate-400">Please wait while we probe the target.</div>
      </div>
    </div>
  `;
  
  scanBtn.disabled = true;
  scanBtn.innerHTML = `
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 animate-spin">
      <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
    </svg>
    Scanning...
  `;

  try {
    const res = await fetch("/api/port-scan/scan", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ target, ports, timeout }),
    });

    const data = await res.json();

    if (data.error) {
      resultsDiv.innerHTML = `
        <div class="p-4 bg-red-900/30 border border-red-700/50 text-red-300 rounded-lg flex items-start gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 flex-shrink-0 mt-0.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
          </svg>
          <div>
            <div class="font-semibold">Scan Error</div>
            <div class="text-sm">${escapeHtml(data.error)}</div>
          </div>
        </div>
      `;
      return;
    }

    // Success - display results
    let html = `
      <div class="mb-4 pb-4 border-b border-slate-700">
        <div class="flex items-center gap-2 mb-3">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-sky-400">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <div class="text-lg font-bold text-slate-200">Scan Complete</div>
        </div>
        <div class="flex flex-wrap gap-2">
          <div class="stat-badge info">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 14.25h13.5m-13.5 0a3 3 0 01-3-3m3 3a3 3 0 100 6h13.5a3 3 0 100-6m-16.5-3a3 3 0 013-3h13.5a3 3 0 013 3m-19.5 0a4.5 4.5 0 01.9-2.7L5.737 5.1a3.375 3.375 0 012.7-1.35h7.126c1.062 0 2.062.5 2.7 1.35l2.587 3.45a4.5 4.5 0 01.9 2.7m0 0a3 3 0 01-3 3m0 3h.008v.008h-.008v-.008zm0-6h.008v.008h-.008v-.008zm-3 6h.008v.008h-.008v-.008zm0-6h.008v.008h-.008v-.008z" />
            </svg>
            Target: <strong>${escapeHtml(data.target)}</strong>
          </div>
          <div class="stat-badge info">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 8.25h15m-16.5 7.5h15m-1.8-13.5l-3.9 19.5m-2.1-19.5l-3.9 19.5" />
            </svg>
            IP: <strong>${escapeHtml(data.ip)}</strong>
          </div>
          <div class="stat-badge success">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            Open: <strong>${data.open_ports}</strong> / ${data.ports_scanned}
          </div>
        </div>
      </div>
    `;

    if (data.results && data.results.length > 0) {
      html += `
        <table>
          <thead>
            <tr>
              <th>Port</th>
              <th>Status</th>
              <th>Service Banner</th>
            </tr>
          </thead>
          <tbody>
      `;

      data.results.forEach(r => {
        const statusClass = r.status === 'open' ? 'status-open' : 'status-closed';
        html += `
          <tr>
            <td class="font-mono font-semibold">${r.port}</td>
            <td class="${statusClass}">${r.status.toUpperCase()}</td>
            <td class="text-slate-400 font-mono text-xs">${escapeHtml(r.banner || "-")}</td>
          </tr>
        `;
      });

      html += `
          </tbody>
        </table>
      `;
    } else {
      html += `<div class="text-slate-500 text-center py-8">No open ports found.</div>`;
    }

    resultsDiv.innerHTML = html;

  } catch (err) {
    console.error(err);
    resultsDiv.innerHTML = `
      <div class="p-4 bg-red-900/30 border border-red-700/50 text-red-300 rounded-lg flex items-start gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 flex-shrink-0 mt-0.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
        </svg>
        <div>
          <div class="font-semibold">Connection Error</div>
          <div class="text-sm">Could not connect to the backend scanner API. Please check if the server is running.</div>
        </div>
      </div>
    `;
  } finally {
    scanBtn.disabled = false;
    scanBtn.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
      </svg>
      Start Scan
    `;
  }
});
</script>
</body>
</html>
